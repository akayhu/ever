'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactRedux=require('react-redux');var _reactI18next=require('react-i18next');var _reactCssModules=require('react-css-modules');var _reactCssModules2=_interopRequireDefault(_reactCssModules);var _index=require('./index.css');var _index2=_interopRequireDefault(_index);var _viewas=require('lib/client/services/viewas.js');var _viewas2=_interopRequireDefault(_viewas);var _social=require('lib/client/actions/social');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}// utils
// actions
// components_mobile
var AppraiseItem=function AppraiseItem(props){var userName=props.userName,jobTitle=props.jobTitle,text=props.text,dataDate=props.dataDate;return _react2.default.createElement('div',{styleName:'appraise_container'},_react2.default.createElement('p',{styleName:'name',className:'body_text'},userName),_react2.default.createElement('p',{styleName:'job',className:'body_text'},jobTitle),_react2.default.createElement('p',{styleName:'text',className:'body_text'},text),_react2.default.createElement('p',{styleName:'date',className:'timestamp'},dataDate))};AppraiseItem=(0,_reactCssModules2.default)(AppraiseItem,_index2.default,{allowMultiple:true});var MAppraise=function(_Component){_inherits(MAppraise,_Component);function MAppraise(props){_classCallCheck(this,MAppraise);var _this=_possibleConstructorReturn(this,(MAppraise.__proto__||Object.getPrototypeOf(MAppraise)).call(this,props));_this.state={more:true,offset:0};_this.showMore=_this.showMore.bind(_this);return _this}_createClass(MAppraise,[{key:'componentWillMount',value:function componentWillMount(){}},{key:'componentDidMount',value:function componentDidMount(){this.queryAppraise()}},{key:'queryAppraise',value:function queryAppraise(){var limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:2;var lastTimeInMillis=this.props.appraise.lastTimeInMillis;var params={targetPid:this.props.params.pid,timeInMillis:lastTimeInMillis,limit:limit,sortByPid:1};this.state.offset+=limit;this.props.queryAppraiseList(params).then(function(res){if(this.state.offset>=res.response.listSize){this.setState({more:false})}}.bind(this))}},{key:'showMore',value:function showMore(){var lastTimeInMillis=this.props.appraise.lastTimeInMillis;this.queryAppraise(5);if(!lastTimeInMillis)this.setState({more:false})}},{key:'render',value:function render(){var appraiseList=this.props.appraise.appraiseList;if(this.props.appraise.appraiseList.length===0)return null;return _react2.default.createElement('div',{styleName:'m_appraise'},_react2.default.createElement('div',null,_react2.default.createElement('span',{styleName:'m_appraise_title'},'\u4ED6\u4EBA\u7684\u8B9A\u7F8E'),_react2.default.createElement('dl',{styleName:'m_appraise_dl'},this.props.appraise.appraiseList.map(function(appraise,i){return _react2.default.createElement('dd',{key:i},_react2.default.createElement('div',{styleName:'bold'},appraise.userName),_react2.default.createElement('div',{styleName:'bold'},appraise.companyName?_react2.default.createElement('span',null,(appraise.jobTitle||'')+'\u3000'+(appraise.companyName||'')):appraise.schoolName?_react2.default.createElement('span',null,(appraise.jobTitle||'')+'\u3000'+(appraise.schoolName||'')):null),_react2.default.createElement('div',{styleName:'font_small'},appraise.text))})),this.state.more&&_react2.default.createElement('div',{styleName:'m_appraise_more'},_react2.default.createElement('span',{onClick:this.showMore.bind(this)},'\u66F4\u591A'))))}}]);return MAppraise}(_react.Component);MAppraise.propTyps={user:_react.PropTypes.object.isRequired,appraise:_react.PropTypes.object.isRequired,viewas:_react.PropTypes.string.isRequired};function mapStateToProps(state,props){return{user:state.user,appraise:state.social.appraise,privacy:state.privacy,viewas:state.profile.viewas}}var MAppraiseCss=(0,_reactCssModules2.default)(MAppraise,_index2.default,{allowMultiple:true});var MAppraiseTranslate=(0,_reactI18next.translate)([])(MAppraiseCss);exports.default=(0,_reactRedux.connect)(mapStateToProps,{queryAppraiseList:_social.queryAppraiseList,queryAppraiseListOfOwner:_social.queryAppraiseListOfOwner})(MAppraiseTranslate);